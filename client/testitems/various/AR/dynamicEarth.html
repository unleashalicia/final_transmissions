<!--<a-scene embedded artoolkit='sourceType: webcam;'>-->

    <!--<a-assets>-->
        <!--<video src="./dust.ogv" id="dust" autoplay loop="true"></video>-->
    <!--</a-assets>-->

    <!--<a-marker preset='hiro'>-->
        <!--<a-entity>-->
            <!--<a-box src='#dust' height="2" width="2" depth="2" material="opacity: 0.9" position="0 0.5 0">-->
                <!--<a-animation attribute="rotation"-->
                             <!--dur="5000"-->
                             <!--to="0 0 360"-->
                             <!--repeat="indefinite">-->
                <!--</a-animation>-->
            <!--</a-box>-->
        <!--</a-entity>-->
    <!--</a-marker>-->
<!--</a-scene>-->

<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Earth Test</title>
    <link rel="stylesheet" type="text/css" href="ARstyle.css" />

    <script src="../../../assets/lib/aframe.js"></script>
    <script src="../../../assets/lib/aframe-ar.js"></script>
</head>

<script>
    AFRAME.registerComponent('log', {
        schema: {type: 'string'},
        init: function () {
            var stringToLog = this.data;
            console.log(stringToLog);
        }
    });
</script>

<body style='margin : 0px; overflow: hidden;'>

    <!--<a-scene embedded artoolkit='sourceType: webcam;'>-->

        <!--<a-assets>-->
            <!--<video src="./dust.ogv" id="dust" autoplay loop="true"></video>-->
        <!--</a-assets>-->

        <!--<a-marker preset='hiro'>-->
            <!--<a-entity>-->
                 <!--<a-box src='#dust' height="2" width="2" depth="2" material="opacity: 0.9" position="0 0.5 0">-->
                    <!--<a-animation attribute="rotation"-->
                        <!--dur="5000"-->
                        <!--to="0 0 360"-->
                        <!--repeat="indefinite">-->
                    <!--</a-animation>-->
                 <!--</a-box>-->
            <!--</a-entity>-->
        <!--</a-marker>-->
    <!--</a-scene>-->


</body>

<script>

    function setAttributes(el, attributeObj) {

        for (let item in attributeObj){
            el.setAttribute(item, attributeObj[item]);
        }

    }




    var earthSceneObj = {
        assets: [
            {
                src: "./dust.ogv",
                id: "dust",
                autoplay: "true",
                loop: "true"
            }
        ],
        marker: {
            preset: "hiro"
        },
        entities: [
            {
                shape: "box",
                dimensions: {
                    height: "1",
                    width: "1",
                    depth: "1"
                },
                material: {
                    opacity: "0.9"
                },
                position: "0 0.5 0",
                otherAttr: {
                    position: "0 0.5 0",
                    src: "#dust",
                    rotation: "0 0 0"
                },
                animations: [
                    {
                        attribute: "rotation",
                        dur: "5000",
                        to: "0 0 360",
                        repeat: "indefinite"
                     }
                ]
            }
        ]
    };


    function createScene(object){

        var body = document.getElementsByTagName('BODY')[0];

        var sceneEl = document.createElement('a-scene');
        sceneEl.setAttribute('embedded', 'true');
        sceneEl.setAttribute('artoolkit', 'sourceType: webcam;');

        var assetsEl = document.createElement('a-assets');


        body.appendChild(sceneEl);
        sceneEl.appendChild(assetsEl);


        for (var assets_i=0; assets_i<object.assets.length; assets_i++){
            var assetItemEl = document.createElement('video');
            setAttributes(assetItemEl, object.assets[assets_i]);
            assetsEl.appendChild(assetItemEl);
        }

        var markerEl = document.createElement('a-marker');
        markerEl.setAttribute("preset", object.marker.preset);
        sceneEl.appendChild(markerEl);

        for (var entity_i=0; entity_i<object.entities.length; entity_i++) {

            var entityEl = document.createElement('a-entity');
            var shapeEl = document.createElement(`a-${object.entities[entity_i].shape}`);


            ////////


            setAttributes(shapeEl, object.entities[entity_i].dimensions);
            shapeEl.setAttribute("opacity", object.entities[entity_i].material.opacity);
//            entityEl.setAttribute("position", object.entities[entity_i].otherAttr.position);
            setAttributes(shapeEl, object.entities[entity_i].otherAttr);
            shapeEl.setAttribute("position", object.entities[entity_i].position);


            console.log(shapeEl);


            ////////

            for (var animation_i = 0; animation_i < object.entities[entity_i].animations.length; animation_i++) {
                var animationEl = document.createElement('a-animation');
                setAttributes(animationEl, object.entities[entity_i].animations[animation_i]);
                shapeEl.appendChild(animationEl);
            }

            entityEl.appendChild(shapeEl);
            sceneEl.appendChild(entityEl);
        }
    }


    window.addEventListener("load", function(){
        createScene(earthSceneObj);
    });

    window.addEventListener("markerFound", function(){
        console.log("markerFound!");
    });




</script>
</html>